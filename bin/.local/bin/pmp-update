#!/usr/bin/env bash

set -o errexit nounset

cleanup() { rm -f "$tempfile"; }
trap cleanup EXIT

tempfile="$(mktemp)"
url="https://knapsu.eu/data/plex/latest"
pmp_appimage="$HOME"/.local/bin/Plex_Media_Player.AppImage
logfile="$HOME"/Downloads/pmp-updated

wget --no-verbose --output-file="$tempfile" "$url" &> "$logfile".log
plexmediaplayer="$(pgrep plexmediaplayer)" && kill "$plexmediaplayer"
trash-put "$pmp_appimage" || echo 'trash-cli package not installed' > "$logfile".err ; exit 1
cp "$tempfile" "$pmp_appimage"
chmod 0755 "$pmp_appimage"
